<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Redisâ€”â€”BitMap | æ•´ç†ä¸€äº›ç¬”è®°</title><meta name="author" content="ä»Šæ™šä¸ç†¬å¤œ"><meta name="copyright" content="ä»Šæ™šä¸ç†¬å¤œ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#e4c6d0"><meta name="description" content="1 åŸºæœ¬å‘½ä»¤Redisæä¾›äº†SETBITã€GETBITã€BITCOUNTã€BITOPå››ä¸ªå¸¸ç”¨å‘½ä»¤ç”¨äºå¤„ç†äºŒè¿›åˆ¶ä½æ•°ç»„ã€‚   SETBITï¼šä¸ºä½æ•°ç»„æŒ‡å®šåç§»é‡ä¸Šçš„äºŒè¿›åˆ¶ä½è®¾ç½®å€¼ï¼Œåç§»é‡ä»0å¼€å§‹è®¡æ•°ï¼ŒäºŒè¿›åˆ¶ä½çš„å€¼åªèƒ½ä¸º0æˆ–1ã€‚è¿”å›åŸä½ç½®å€¼ã€‚ GETBITï¼šè·å–æŒ‡å®šåç§»é‡ä¸ŠäºŒè¿›åˆ¶ä½çš„å€¼ã€‚  BITCOUNTï¼šç»Ÿè®¡ä½æ•°ç»„ä¸­å€¼ä¸º1çš„äºŒè¿›åˆ¶ä½æ•°é‡ã€‚ BITOPï¼šå¯¹å¤šä¸ªä½æ•°ç»„è¿›è¡ŒæŒ‰ä½ä¸ã€æˆ–ã€å¼‚æˆ–è¿ç®—ã€‚   2">
<meta property="og:type" content="article">
<meta property="og:title" content="Redisâ€”â€”BitMap">
<meta property="og:url" content="http://quanquan170.github.io/2023/03/20/redis-bitmap/index.html">
<meta property="og:site_name" content="æ•´ç†ä¸€äº›ç¬”è®°">
<meta property="og:description" content="1 åŸºæœ¬å‘½ä»¤Redisæä¾›äº†SETBITã€GETBITã€BITCOUNTã€BITOPå››ä¸ªå¸¸ç”¨å‘½ä»¤ç”¨äºå¤„ç†äºŒè¿›åˆ¶ä½æ•°ç»„ã€‚   SETBITï¼šä¸ºä½æ•°ç»„æŒ‡å®šåç§»é‡ä¸Šçš„äºŒè¿›åˆ¶ä½è®¾ç½®å€¼ï¼Œåç§»é‡ä»0å¼€å§‹è®¡æ•°ï¼ŒäºŒè¿›åˆ¶ä½çš„å€¼åªèƒ½ä¸º0æˆ–1ã€‚è¿”å›åŸä½ç½®å€¼ã€‚ GETBITï¼šè·å–æŒ‡å®šåç§»é‡ä¸ŠäºŒè¿›åˆ¶ä½çš„å€¼ã€‚  BITCOUNTï¼šç»Ÿè®¡ä½æ•°ç»„ä¸­å€¼ä¸º1çš„äºŒè¿›åˆ¶ä½æ•°é‡ã€‚ BITOPï¼šå¯¹å¤šä¸ªä½æ•°ç»„è¿›è¡ŒæŒ‰ä½ä¸ã€æˆ–ã€å¼‚æˆ–è¿ç®—ã€‚   2">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://quanquan170.github.io/img/background/bg_bggenerator_com%20(2).png">
<meta property="article:published_time" content="2023-03-20T03:59:20.000Z">
<meta property="article:modified_time" content="2023-03-21T06:12:28.932Z">
<meta property="article:author" content="ä»Šæ™šä¸ç†¬å¤œ">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://quanquan170.github.io/img/background/bg_bggenerator_com%20(2).png"><link rel="shortcut icon" href="/img/avatar.svg"><link rel="canonical" href="http://quanquan170.github.io/2023/03/20/redis-bitmap/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"B8BRZ1L2TD","apiKey":"8bb4e18949e6c588f375c44adfbad5e0","indexName":"quan","hits":{"per_page":6},"languages":{"input_placeholder":"æœç´¢æ–‡ç« ","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redisâ€”â€”BitMap',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-21 14:12:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#41555d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#e4c6d0')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.svg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-fw icon-resume-line"></i><span> å…³äºä½œè€…</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: url(/img/imgs/redis.png)"><nav id="nav"><span id="blog-info"><a href="/" title="æ•´ç†ä¸€äº›ç¬”è®°"><img class="site-icon" src="/img/avatar.svg"/><span class="site-name">ä»Šæ™šä¸ç†¬å¤œ</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-fw icon-resume-line"></i><span> å…³äºä½œè€…</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Redisâ€”â€”BitMap</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-03-20T03:59:20.000Z" title="å‘è¡¨äº 2023-03-20 11:59:20">2023-03-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-03-21T06:12:28.932Z" title="æ›´æ–°äº 2023-03-21 14:12:28">2023-03-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95%E5%87%86%E5%A4%87/">é¢è¯•å‡†å¤‡</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">3.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>13åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Redisâ€”â€”BitMap"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="1-åŸºæœ¬å‘½ä»¤"><a href="#1-åŸºæœ¬å‘½ä»¤" class="headerlink" title="1 åŸºæœ¬å‘½ä»¤"></a>1 åŸºæœ¬å‘½ä»¤</h3><p>Redisæä¾›äº†<code>SETBIT</code>ã€<code>GETBIT</code>ã€<code>BITCOUNT</code>ã€<code>BITOP</code>å››ä¸ªå¸¸ç”¨å‘½ä»¤ç”¨äºå¤„ç†äºŒè¿›åˆ¶ä½æ•°ç»„ã€‚</p>
<blockquote>
<ul>
<li><code>SETBIT</code>ï¼šä¸ºä½æ•°ç»„æŒ‡å®šåç§»é‡ä¸Šçš„äºŒè¿›åˆ¶ä½è®¾ç½®å€¼ï¼Œåç§»é‡ä»0å¼€å§‹è®¡æ•°ï¼ŒäºŒè¿›åˆ¶ä½çš„å€¼åªèƒ½ä¸º0æˆ–1ã€‚è¿”å›åŸä½ç½®å€¼ã€‚</li>
<li><code>GETBIT</code>ï¼šè·å–æŒ‡å®šåç§»é‡ä¸ŠäºŒè¿›åˆ¶ä½çš„å€¼ã€‚</li>
<li><code> BITCOUNT</code>ï¼šç»Ÿè®¡ä½æ•°ç»„ä¸­å€¼ä¸º1çš„äºŒè¿›åˆ¶ä½æ•°é‡ã€‚</li>
<li><code>BITOP</code>ï¼šå¯¹å¤šä¸ªä½æ•°ç»„è¿›è¡ŒæŒ‰ä½ä¸ã€æˆ–ã€å¼‚æˆ–è¿ç®—ã€‚</li>
</ul>
</blockquote>
<h3 id="2-æºç åˆ†æ"><a href="#2-æºç åˆ†æ" class="headerlink" title="2 æºç åˆ†æ"></a>2 æºç åˆ†æ</h3><h4 id="2-1-æ•°æ®ç»“æ„"><a href="#2-1-æ•°æ®ç»“æ„" class="headerlink" title="2.1 æ•°æ®ç»“æ„"></a>2.1 æ•°æ®ç»“æ„</h4><blockquote>
<p><strong>æ‰©å±•ï¼šRedis ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æ˜¯æœ‰ä¸€ä¸ª redisObject ç»“æ„è¡¨ç¤ºçš„ã€‚</strong></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span> <span class="token punctuation">{</span>
     <span class="token comment">// ç±»å‹</span>
     <span class="token keyword">unsigned</span> type<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
     <span class="token comment">// ç¼–ç </span>
     <span class="token keyword">unsigned</span> encoding<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
     <span class="token keyword">unsigned</span> lru<span class="token operator">:</span>REDIS_LRU_BITS<span class="token punctuation">;</span> <span class="token comment">/* lru time (relative to server.lruclock) */</span>
     <span class="token comment">// å¼•ç”¨è®¡æ•°</span>
     <span class="token keyword">int</span> refcount<span class="token punctuation">;</span>
     <span class="token comment">// æ‰§è¡Œåº•å±‚å®ç°çš„æ•°æ®ç»“æ„çš„æŒ‡é’ˆ</span>
     <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>
<span class="token punctuation">}</span> robj<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


</blockquote>
<p><img src="/2023/03/20/redis-bitmap/640.png"></p>
<ul>
<li><code>type</code> çš„å€¼ä¸º <code>REDIS_STRING</code>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</li>
<li><code>sdshdr.len</code> çš„å€¼ä¸º1è¡¨ç¤ºè¿™ä¸ªSDSä¿å­˜äº†ä¸€ä¸ª1å­—èŠ‚å¤§å°çš„ä½æ•°ç»„</li>
<li>bufæ•°ç»„ä¸­çš„<code>buf[0]</code>å®é™…ä¿å­˜äº†ä½æ•°ç»„</li>
<li>bufæ•°ç»„ä¸­çš„<code>buf[1]</code>ä¸ºè‡ªåŠ¨è¿½åŠ çš„<code>\0</code>å­—ç¬¦</li>
</ul>
<h4 id="3-2-GETBIT"><a href="#3-2-GETBIT" class="headerlink" title="3.2 GETBIT"></a>3.2 GETBIT</h4><p><code>GETBIT</code>ç”¨äºè¿”å›ä½æ•°ç»„åœ¨åç§»é‡ä¸Šçš„äºŒè¿›åˆ¶ä½çš„å€¼ã€‚**<code>GETBIT</code>çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(1)</code>ã€‚**</p>
<p><code>GETBIT</code>å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>è®¡ç®—byte=âŒŠoffsetÃ·8âŒ‹ (å³<code>&gt;&gt;3</code>)ï¼Œbyte å€¼è¡¨ç¤ºæŒ‡å®šçš„ <em>offset</em> ä½äºä½æ•°ç»„çš„å“ªä¸ªå­—èŠ‚(è®¡ç®—åœ¨ç¬¬å‡ è¡Œ)ï¼›</li>
<li>æŒ‡å®š buf[i]ä¸­çš„iäº†ï¼Œæ¥ä¸‹æ¥å°±è¦è®¡ç®—åœ¨8ä¸ªå­—èŠ‚ä¸­çš„ç¬¬å‡ ä½ï¼šä½¿ç”¨ <code>bit=(offset % 8)+1</code>ï¼ˆå–æ¨¡è¿ç®—ç”¨ä½è¿ç®—å–æœ€ä½ä¸‰ä½ä»£æ›¿ï¼‰è®¡ç®—å¯å¾—ï¼›</li>
<li>æ ¹æ® byte å’Œ bitåœ¨ä½æ•°ç»„ä¸­å®šä½åˆ°ç›®æ ‡å€¼è¿”å›å³å¯ã€‚</li>
</ol>
<p>æºç :</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">getbitCommand</span><span class="token punctuation">(</span>client <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    robj <span class="token operator">*</span>o<span class="token punctuation">;</span>
    <span class="token keyword">char</span> llbuf<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span> bitoffset<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> byte<span class="token punctuation">,</span> bit<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> bitval <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–offset</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getBitOffsetFromArgument</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>c<span class="token operator">-&gt;</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>bitoffset<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> C_OK<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token comment">// æŸ¥æ‰¾å¯¹åº”çš„ä½å›¾å¯¹è±¡</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>o <span class="token operator">=</span> <span class="token function">lookupKeyReadOrReply</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>c<span class="token operator">-&gt;</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>shared<span class="token punctuation">.</span>czero<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span>
        <span class="token function">checkType</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>o<span class="token punctuation">,</span>OBJ_STRING<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token comment">// è®¡ç®—offsetä½äºä½æ•°ç»„çš„å“ªä¸€è¡Œ</span>
    byte <span class="token operator">=</span> bitoffset <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¡ç®—offsetåœ¨ä¸€è¡Œä¸­çš„ç¬¬å‡ ä½ï¼Œç­‰åŒäºå–æ¨¡ï¼Œå–æœ€åå‡ ä½</span>
    bit <span class="token operator">=</span> <span class="token number">7</span> <span class="token operator">-</span> <span class="token punctuation">(</span>bitoffset <span class="token operator">&amp;</span> <span class="token number">0x7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// #define sdsEncodedObject(objptr) (objptr-&gt;encoding == OBJ_ENCODING_RAW || objptr-&gt;encoding == OBJ_ENCODING_EMBSTR)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sdsEncodedObject</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// SDS æ˜¯RAW æˆ–è€… EMBSTRç±»å‹</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>byte <span class="token operator">&lt;</span> <span class="token function">sdslen</span><span class="token punctuation">(</span>o<span class="token operator">-&gt;</span>ptr<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// è·å–æŒ‡å®šä½ç½®çš„å€¼</span>
            <span class="token comment">// æ³¨æ„å®ƒä¸æ˜¯çœŸæ­£çš„ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸èƒ½ç”¨((uint8_t*)o-&gt;ptr)[byte][bit]å»è·å–å‘€~</span>
            bitval <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span>o<span class="token operator">-&gt;</span>ptr<span class="token punctuation">)</span><span class="token punctuation">[</span>byte<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> bit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//  SDS æ˜¯ REDIS_ENCODING_INT ç±»å‹çš„æ•´æ•°ï¼Œå…ˆè½¬ä¸ºString</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>byte <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span><span class="token punctuation">)</span><span class="token function">ll2string</span><span class="token punctuation">(</span>llbuf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>llbuf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>o<span class="token operator">-&gt;</span>ptr<span class="token punctuation">)</span><span class="token punctuation">)</span>
            bitval <span class="token operator">=</span> llbuf<span class="token punctuation">[</span>byte<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> bit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">addReply</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> bitval <span class="token operator">?</span> shared<span class="token punctuation">.</span>cone <span class="token operator">:</span> shared<span class="token punctuation">.</span>czero<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/03/20/redis-bitmap/640-16792863934224.png"></p>
<h4 id="3-3-SETBIT"><a href="#3-3-SETBIT" class="headerlink" title="3.3 SETBIT"></a>3.3 SETBIT</h4><p><code>SETBIT</code>ç”¨äºå°†ä½æ•°ç»„åœ¨åç§»é‡çš„äºŒè¿›åˆ¶ä½çš„å€¼è®¾ä¸ºvalueï¼Œå¹¶å‘å®¢æˆ·ç«¯è¿”å›æ—§å€¼ã€‚</p>
<p><code>SITBIT</code>å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>è®¡ç®—len=âŒŠoffsetÃ·8âŒ‹+1ï¼Œlenå€¼è®°å½•äº†ä¿å­˜offsetåç§»é‡æŒ‡å®šçš„äºŒè¿›åˆ¶ä½è‡³å°‘éœ€è¦å¤šå°‘å­—èŠ‚</li>
<li>æ£€æŸ¥ä½æ•°ç»„çš„é•¿åº¦æ˜¯å¦å°äºlenï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°†SDSçš„é•¿åº¦æ‰©å±•ä¸ºlenå­—èŠ‚,å¹¶å°†æ‰€æœ‰æ–°æ‰©å±•ç©ºé—´çš„äºŒè¿›åˆ¶ä½è®¾ç½®ä¸º0</li>
<li>è®¡ç®—byte=âŒŠoffsetÃ·8âŒ‹ï¼Œbyteå€¼è¡¨ç¤ºæŒ‡å®šçš„offsetä½äºä½æ•°ç»„çš„é‚£ä¸ªå­—èŠ‚(å°±æ˜¯è®¡ç®—åœ¨é‚£ä¸ªbuf[i]ä¸­çš„iii)</li>
<li>ä½¿ç”¨bit=(offset mod 8)+1è®¡ç®—å¯å¾—ç›®æ ‡buf[i]çš„å…·ä½“ç¬¬å‡ ä½</li>
<li>æ ¹æ®byteå’Œbitçš„å€¼ï¼Œé¦–å…ˆä¿å­˜oldValueï¼Œç„¶åå°†æ–°å€¼valueè®¾ç½®åˆ°ç›®æ ‡ä½ä¸Š</li>
<li>è¿”å›æ—§å€¼</li>
</ol>
<blockquote>
<p><strong>å› ä¸ºSETBITå‘½ä»¤æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…å®Œæˆï¼Œæ‰€ä»¥è¯¥å‘½ä»¤çš„ç®—æ³•å¤æ‚åº¦ä¸ºO(1)ã€‚</strong></p>
</blockquote>
<p><code>SETBIT</code>å‘½ä»¤æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">setbitCommand</span><span class="token punctuation">(</span>client <span class="token operator">*</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    robj <span class="token operator">*</span>o<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>err <span class="token operator">=</span> <span class="token string">"bit is not an integer or out of range"</span><span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span> bitoffset<span class="token punctuation">;</span>
    <span class="token class-name">ssize_t</span> byte<span class="token punctuation">,</span> bit<span class="token punctuation">;</span>
    <span class="token keyword">int</span> byteval<span class="token punctuation">,</span> bitval<span class="token punctuation">;</span>
    <span class="token keyword">long</span> on<span class="token punctuation">;</span>
    <span class="token comment">// è·å–offset</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getBitOffsetFromArgument</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>c<span class="token operator">-&gt;</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>bitoffset<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> C_OK<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–æˆ‘ä»¬éœ€è¦è®¾ç½®çš„å€¼</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getLongFromObjectOrReply</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>c<span class="token operator">-&gt;</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>on<span class="token punctuation">,</span>err<span class="token punctuation">)</span> <span class="token operator">!=</span> C_OK<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token comment">/* åˆ¤æ–­æŒ‡å®šå€¼æ˜¯å¦ä¸º0æˆ–1 */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>on <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è®¾ç½®äº†0å’Œ1ä¹‹å¤–çš„å€¼ï¼Œç›´æ¥æŠ¥é”™</span>
        <span class="token function">addReplyError</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ ¹æ®keyæŸ¥è¯¢SDSå¯¹è±¡ï¼ˆä¼šè‡ªåŠ¨æ‰©å®¹ï¼‰</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>o <span class="token operator">=</span> <span class="token function">lookupStringForBitCommand</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>bitoffset<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token comment">/* è·å¾—å½“å‰å€¼ */</span>
    byte <span class="token operator">=</span> bitoffset <span class="token operator">&gt;&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
    byteval <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span>o<span class="token operator">-&gt;</span>ptr<span class="token punctuation">)</span><span class="token punctuation">[</span>byte<span class="token punctuation">]</span><span class="token punctuation">;</span>
    bit <span class="token operator">=</span> <span class="token number">7</span> <span class="token operator">-</span> <span class="token punctuation">(</span>bitoffset <span class="token operator">&amp;</span> <span class="token number">0x7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bitval <span class="token operator">=</span> byteval <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> bit<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* æ›´æ–°å€¼å¹¶è¿”å›æ—§å€¼ */</span>
    byteval <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> bit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    byteval <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>on <span class="token operator">&amp;</span> <span class="token number">0x1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> bit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span>o<span class="token operator">-&gt;</span>ptr<span class="token punctuation">)</span><span class="token punctuation">[</span>byte<span class="token punctuation">]</span> <span class="token operator">=</span> byteval<span class="token punctuation">;</span>
    <span class="token comment">// å‘é€æ•°æ®ä¿®æ”¹é€šçŸ¥</span>
    <span class="token function">signalModifiedKey</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>c<span class="token operator">-&gt;</span>db<span class="token punctuation">,</span>c<span class="token operator">-&gt;</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">notifyKeyspaceEvent</span><span class="token punctuation">(</span>NOTIFY_STRING<span class="token punctuation">,</span><span class="token string">"setbit"</span><span class="token punctuation">,</span>c<span class="token operator">-&gt;</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>c<span class="token operator">-&gt;</span>db<span class="token operator">-&gt;</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    server<span class="token punctuation">.</span>dirty<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">addReply</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> bitval <span class="token operator">?</span> shared<span class="token punctuation">.</span>cone <span class="token operator">:</span> shared<span class="token punctuation">.</span>czero<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ï¼ˆè¿™ä¸ªå›¾æˆ‘çœŸçš„ï¼Œæˆ‘å“­é¼ ï¼Œä»–æ˜¯çœŸçš„æƒ³è®©æˆ‘å­¦ä¼šçš„ğŸ˜­ï¼‰</p>
<p><img src="/2023/03/20/redis-bitmap/640-16792866625376.png"></p>
<h4 id="2-4-BITCOUNT"><a href="#2-4-BITCOUNT" class="headerlink" title="2.4 BITCOUNT"></a>2.4 BITCOUNT</h4><p><code>BITCOUNT</code>å‘½ä»¤ç”¨äºç»Ÿè®¡ç»™å®šä½æ•°ç»„ä¸­å€¼ä¸º1çš„äºŒè¿›åˆ¶ä½çš„æ•°é‡ã€‚åŠŸèƒ½ä¼¼ä¹ä¸å¤æ‚ï¼Œä½†å®é™…ä¸Šè¦é«˜æ•ˆåœ°å®ç°è¿™ä¸ªå‘½ä»¤å¹¶ä¸å®¹æ˜“ï¼Œéœ€è¦ç”¨åˆ°ä¸€äº›ç²¾å·§çš„ç®—æ³•ã€‚</p>
<blockquote>
<p><strong>ç»Ÿè®¡ä¸€ä¸ªä½æ•°ç»„ä¸­é0äºŒè¿›åˆ¶ä½çš„æ•°é‡åœ¨æ•°å­¦ä¸Šè¢«ç§°ä¸ºâ€è®¡ç®—æ±‰æ˜é‡é‡â€ã€‚</strong></p>
</blockquote>
<h5 id="äºŒè¿›åˆ¶ä½ç»Ÿè®¡ç®—æ³•-variable-precision-SWAR"><a href="#äºŒè¿›åˆ¶ä½ç»Ÿè®¡ç®—æ³•-variable-precision-SWAR" class="headerlink" title="äºŒè¿›åˆ¶ä½ç»Ÿè®¡ç®—æ³•:variable-precision SWAR"></a>äºŒè¿›åˆ¶ä½ç»Ÿè®¡ç®—æ³•:variable-precision SWAR</h5><p>ç›®å‰å·²çŸ¥æ•ˆç‡æœ€å¥½çš„é€šç”¨ç®—æ³•ä¸º<code>variable-precision SWAR</code>ç®—æ³•ï¼Œè¯¥ç®—æ³•é€šè¿‡ä¸€ç³»åˆ—ä½ç§»å’Œä½è¿ç®—æ“ä½œï¼Œå¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…è®¡ç®—å¤šä¸ªå­—èŠ‚çš„æ±‰æ˜é‡é‡ï¼Œå¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨ä»»ä½•é¢å¤–çš„å†…å­˜</p>
<p>ç®—æ³•ä»£ç ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">uint32_t</span> <span class="token function">swar</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 5çš„äºŒè¿›åˆ¶ï¼š0101</span>
    i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3çš„äºŒè¿›åˆ¶ï¼š0011</span>
    i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> <span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0x01010101</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token comment">//â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”ä¸Šé¢ä¸ºå±•å¼€ç‰ˆï¼Œä¸‹é¢ä¸ºæ›´ç®€æ´ç‰ˆâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span>
    i <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0x01010101</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li>æ­¥éª¤ä¸€è®¡ç®—å‡ºçš„å€¼içš„äºŒè¿›åˆ¶è¡¨ç¤ºå¯ä»¥æŒ‰<strong>æ¯ä¸¤ä¸ªäºŒè¿›åˆ¶ä½ä¸ºä¸€ç»„è¿›è¡Œåˆ†ç»„</strong>ï¼Œå„ç»„çš„åè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯è¯¥ç»„çš„1çš„æ•°é‡ï¼›</li>
<li>æ­¥éª¤äºŒè®¡ç®—å‡ºçš„å€¼içš„äºŒè¿›åˆ¶è¡¨ç¤ºå¯ä»¥æŒ‰<strong>æ¯å››ä¸ªäºŒè¿›åˆ¶ä½ä¸ºä¸€ç»„è¿›è¡Œåˆ†ç»„</strong>ï¼Œå„ç»„çš„åè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯è¯¥ç»„çš„1çš„æ•°é‡ï¼›</li>
<li>æ­¥éª¤ä¸‰è®¡ç®—å‡ºçš„å€¼içš„äºŒè¿›åˆ¶è¡¨ç¤ºå¯ä»¥æŒ‰<strong>æ¯å…«ä¸ªäºŒè¿›åˆ¶ä½ä¸ºä¸€ç»„è¿›è¡Œåˆ†ç»„</strong>ï¼Œå„ç»„çš„åè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯è¯¥ç»„çš„1çš„æ•°é‡ï¼›</li>
<li>æ­¥éª¤å››çš„<code>i*0x01010101</code>è¯­å¥è®¡ç®—å‡ºbitarrayä¸­1çš„æ•°é‡å¹¶è®°å½•åœ¨äºŒè¿›åˆ¶ä½çš„æœ€é«˜å…«ä½ï¼Œè€Œ<code>&gt;&gt;24</code>è¯­å¥åˆ™é€šè¿‡å³ç§»è¿ç®—ï¼Œå°†bitarrayçš„æ±‰æ˜é‡é‡ç§»åŠ¨åˆ°æœ€ä½å…«ä½ï¼Œå¾—å‡ºçš„ç»“æœå°±æ˜¯bitarrayçš„æ±‰æ˜é‡é‡ã€‚</li>
</ol>
<blockquote>
<p> <strong>Integer.bitCountæ–¹æ³•ï¼Œä¹Ÿæ˜¯åŸºäºSWARç®—æ³•çš„æ€æƒ³</strong></p>
</blockquote>
<h5 id="2-4-4-æºç åˆ†æ"><a href="#2-4-4-æºç åˆ†æ" class="headerlink" title="2.4.4 æºç åˆ†æ"></a>2.4.4 æºç åˆ†æ</h5><p>Redis ä¸­é€šè¿‡è°ƒç”¨<code>redisPopcount</code>æ–¹æ³•ç»Ÿè®¡æ±‰æ˜é‡é‡ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token function">redisPopcount</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> bits <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> s<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> <span class="token operator">*</span>p4<span class="token punctuation">;</span>
    <span class="token comment">// ä¸ºæŸ¥è¡¨æ³•å‡†å¤‡çš„è¡¨</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> bitsinbyte<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// CPUä¸€æ¬¡æ€§è¯»å–8ä¸ªå­—èŠ‚ï¼Œå¦‚æœ4å­—èŠ‚è·¨äº†ä¸¤ä¸ª8å­—èŠ‚ï¼Œéœ€è¦è¯»å–ä¸¤æ¬¡æ‰è¡Œ</span>
    <span class="token comment">// æ‰€ä»¥è€ƒè™‘4å­—èŠ‚å¯¹é½ï¼Œåªéœ€è¯»å–ä¸€æ¬¡å°±å¯ä»¥è¯»å–å®Œæ¯•</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span>p <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bits <span class="token operator">+=</span> bitsinbyte<span class="token punctuation">[</span><span class="token operator">*</span>p<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        count<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ä¸€æ¬¡æ€§å¤„ç†28å­—èŠ‚ï¼Œå•ç‹¬çœ‹ä¸€ä¸ªauxå°±å®¹æ˜“ç†è§£äº†ï¼Œå…¶å®å°±æ˜¯SWARç®—æ³•</span>
    <span class="token comment">// uint32_tï¼š4å­—èŠ‚</span>
    p4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>count<span class="token operator">&gt;=</span><span class="token number">28</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">uint32_t</span> aux1<span class="token punctuation">,</span> aux2<span class="token punctuation">,</span> aux3<span class="token punctuation">,</span> aux4<span class="token punctuation">,</span> aux5<span class="token punctuation">,</span> aux6<span class="token punctuation">,</span> aux7<span class="token punctuation">;</span>

        aux1 <span class="token operator">=</span> <span class="token operator">*</span>p4<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">// ä¸€æ¬¡æ€§è¯»å–4å­—èŠ‚</span>
        aux2 <span class="token operator">=</span> <span class="token operator">*</span>p4<span class="token operator">++</span><span class="token punctuation">;</span>
        aux3 <span class="token operator">=</span> <span class="token operator">*</span>p4<span class="token operator">++</span><span class="token punctuation">;</span>
        aux4 <span class="token operator">=</span> <span class="token operator">*</span>p4<span class="token operator">++</span><span class="token punctuation">;</span>
        aux5 <span class="token operator">=</span> <span class="token operator">*</span>p4<span class="token operator">++</span><span class="token punctuation">;</span>
        aux6 <span class="token operator">=</span> <span class="token operator">*</span>p4<span class="token operator">++</span><span class="token punctuation">;</span>
        aux7 <span class="token operator">=</span> <span class="token operator">*</span>p4<span class="token operator">++</span><span class="token punctuation">;</span>
        count <span class="token operator">-=</span> <span class="token number">28</span><span class="token punctuation">;</span><span class="token comment">// å…±å¤„ç†äº†4*7=28ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥countéœ€è¦å‡å»28</span>

        aux1 <span class="token operator">=</span> aux1 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux1 <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux1 <span class="token operator">=</span> <span class="token punctuation">(</span>aux1 <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux1 <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux2 <span class="token operator">=</span> aux2 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux2 <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux2 <span class="token operator">=</span> <span class="token punctuation">(</span>aux2 <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux2 <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux3 <span class="token operator">=</span> aux3 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux3 <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux3 <span class="token operator">=</span> <span class="token punctuation">(</span>aux3 <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux3 <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux4 <span class="token operator">=</span> aux4 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux4 <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux4 <span class="token operator">=</span> <span class="token punctuation">(</span>aux4 <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux4 <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux5 <span class="token operator">=</span> aux5 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux5 <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux5 <span class="token operator">=</span> <span class="token punctuation">(</span>aux5 <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux5 <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux6 <span class="token operator">=</span> aux6 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux6 <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux6 <span class="token operator">=</span> <span class="token punctuation">(</span>aux6 <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux6 <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux7 <span class="token operator">=</span> aux7 <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux7 <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x55555555</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aux7 <span class="token operator">=</span> <span class="token punctuation">(</span>aux7 <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>aux7 <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x33333333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bits <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>aux1 <span class="token operator">+</span> <span class="token punctuation">(</span>aux1 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>aux2 <span class="token operator">+</span> <span class="token punctuation">(</span>aux2 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>aux3 <span class="token operator">+</span> <span class="token punctuation">(</span>aux3 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>aux4 <span class="token operator">+</span> <span class="token punctuation">(</span>aux4 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>aux5 <span class="token operator">+</span> <span class="token punctuation">(</span>aux5 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>aux6 <span class="token operator">+</span> <span class="token punctuation">(</span>aux6 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>aux7 <span class="token operator">+</span> <span class="token punctuation">(</span>aux7 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F0F0F0F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span> <span class="token number">0x01010101</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* å‰©ä½™çš„ä¸è¶³28å­—èŠ‚ï¼Œä½¿ç”¨æŸ¥è¡¨æ³•ç»Ÿè®¡ */</span>
    p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>p4<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>count<span class="token operator">--</span><span class="token punctuation">)</span> bits <span class="token operator">+=</span> bitsinbyte<span class="token punctuation">[</span><span class="token operator">*</span>p<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bits<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Redis ä¸­åŒæ—¶è¿ç”¨äº†<strong>æŸ¥è¡¨æ³•</strong>å’Œ<strong>SWARç®—æ³•</strong>å®Œæˆ<code>BITCOUNT</code>åŠŸèƒ½ã€‚</p>
<h3 id="3-åº”ç”¨"><a href="#3-åº”ç”¨" class="headerlink" title="3 åº”ç”¨"></a>3 åº”ç”¨</h3><p>å¤§é‡æ•°æ®å»é‡ã€æ’åºã€ç”¨æˆ·ç­¾åˆ°ã€ç»Ÿè®¡æ´»è·ƒç”¨æˆ·ã€å®ç°å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»å¸ƒéš†è¿‡æ»¤å™¨</p>
<h4 id="å¸ƒéš†è¿‡æ»¤å™¨ç®€ä»‹å’Œç®—æ³•æµç¨‹"><a href="#å¸ƒéš†è¿‡æ»¤å™¨ç®€ä»‹å’Œç®—æ³•æµç¨‹" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨ç®€ä»‹å’Œç®—æ³•æµç¨‹"></a>å¸ƒéš†è¿‡æ»¤å™¨ç®€ä»‹å’Œç®—æ³•æµç¨‹</h4><blockquote>
<p><strong>ä¸»è¦ç‰¹å¾</strong></p>
<p>ä¸€ç§ç´§å‡‘å‹çš„ã€æ¯”è¾ƒå·§å¦™çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œå®ƒç”±ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡( ä½å‘é‡)å’Œä¸€ç³»åˆ—éšæœºå‡åŒ€åˆ†å¸ƒçš„æ•£åˆ—( å“ˆå¸Œ)å‡½æ•°ç»„æˆ æ­¤ç§æ–¹å¼ä¸ä»…å¯ä»¥æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œä¹Ÿå¯ä»¥èŠ‚çœå¤§é‡çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>å­˜åœ¨å‡é˜³æ€§ï¼ˆå°†ä¸åœ¨é›†åˆä¸­çš„å…ƒç´ è¯¯åˆ¤ä¸ºåœ¨é›†åˆä¸­ï¼‰ï¼Œä¸å­˜åœ¨å‡é˜´æ€§ï¼ˆå°†åœ¨é›†åˆä¸­çš„å…ƒç´ è¯¯åˆ¤ä¸ºä¸åœ¨é›†åˆä¸­ï¼‰ã€‚è¿‡æ»¤å™¨ä¸­çš„å…ƒç´ ä¸ªæ•°è¶Šå¤šï¼Œå‡é˜³æ€§çš„å¯èƒ½æ€§è¶Šå¤§ï¼Œæ€»çš„æ¥è¯´ï¼Œå½“ä¸è€ƒè™‘é›†åˆä¸­å…ƒç´ ä¸ªæ•°çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå…ƒç´ ç”±10ä¸ªä»¥ä¸‹çš„bitæ¥è¡¨ç¤ºå°±å¯ä»¥ä¿è¯1%ä»¥å†…çš„å‡é˜³æ€§æ¦‚ç‡ã€‚</p>
<p>å…ƒç´ å¯ä»¥è¢«åŠ å…¥è¿‡æ»¤å™¨ï¼Œä½†ä¸å¯ä»è¿‡æ»¤å™¨ä¸­åˆ é™¤ï¼ˆå› ä¸ºåˆ é™¤çš„æ—¶å€™æœ‰å¯èƒ½ä¼šå½±å“åˆ°å…¶ä»–å…ƒç´ ï¼Œä¹‹åä¼šç»†è¯´ï¼‰ã€‚</p>
<p><strong>ç©ºé—´å’Œæ—¶é—´ä¼˜åŠ¿</strong></p>
<p>å¸ƒéš†è¿‡æ»¤å™¨ä¸éœ€è¦å­˜å‚¨æ•°æ®é¡¹ï¼Œä½†æ˜¯åŒæ—¶å®ƒéœ€è¦åœ¨å…¶ä»–åœ°æ–¹å•ç‹¬å­˜å‚¨çœŸæ­£çš„æ•°æ®é¡¹ã€‚å¯¹äºä¸€ä¸ªæ‹¥æœ‰æœ€ä¼˜kå€¼ä¸”è¯¯åˆ¤ç‡åœ¨1%çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œæ¯ä¸ªå…ƒç´ åªéœ€è¦9.6bitsï¼ˆä¸å…ƒç´ çš„å¤§å°æ— å…³ï¼‰ã€‚è¿™ä¸ªä¼˜ç‚¹ä¸€éƒ¨åˆ†ç»§æ‰¿è‡ªæ•°ç»„çš„ç´§å‡‘æ€§ï¼Œå¦ä¸€æ–¹é¢ç”±å®ƒæœ¬èº«çš„æ¦‚ç‡æ€§å†³å®šã€‚è‹¥ç»™æ¯ä¸ªå…ƒç´ å¢åŠ 4.8bitså·¦å³ï¼Œè¯¯åˆ¤ç‡å°†ä¼šå‡å°‘åå€ã€‚</p>
<p>å¸ƒéš†è¿‡æ»¤å™¨åœ¨æ·»åŠ å’ŒæŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œæ‰€éœ€è¦çš„æ—¶é—´æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼ŒO(k)ï¼Œå®Œå…¨ä¸é›†åˆä¸­å…ƒç´ ä¸ªæ•°æ— å…³ã€‚æ²¡æœ‰å…¶ä»–å›ºå®šç©ºé—´çš„é›†åˆæ•°æ®ç»“æ„æœ‰è¿™æ ·çš„æ•ˆç‡ï¼Œä½†æ˜¯å¯¹äºç¨€ç–æ•£åˆ—è¡¨æ¥è¯´ï¼Œå¹³å‡è®¿é—®æ—¶é•¿åœ¨å®é™…ä½¿ç”¨ä¸­æ¯”ä¸€äº›å¸ƒéš†è¿‡æ»¤å™¨è¦çŸ­ã€‚åœ¨ç¡¬ä»¶å®ç°æ–¹å¼ä¸­ï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„ä¼˜åŠ¿åœ¨äºä»–çš„kä¸ªæŸ¥è¯¢ä¹‹é—´ä¸ç›¸å…³ï¼Œå› æ­¤<strong>å¯ä»¥å¹¶è¡Œå¤„ç†</strong>ã€‚</p>
</blockquote>
<p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰çš„æ ¸å¿ƒå®ç°æ˜¯ä¸€ä¸ªè¶…å¤§çš„ä½æ•°ç»„å’Œå‡ ä¸ªå“ˆå¸Œå‡½æ•°ã€‚å‡è®¾ä½æ•°ç»„çš„é•¿åº¦ä¸ºmï¼Œå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°ä¸ºk</p>
<p><img src="/2023/03/20/redis-bitmap/1030776-20170106143141784-1475031003.png"></p>
<p>ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå…·ä½“çš„æ“ä½œæµç¨‹ï¼š</p>
<p>å‡è®¾é›†åˆé‡Œé¢æœ‰3ä¸ªå…ƒç´ {x, y, z}ï¼Œå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°ä¸º3ã€‚</p>
<ol>
<li><p>é¦–å…ˆå°†ä½æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†é‡Œé¢æ¯ä¸ªä½éƒ½è®¾ç½®ä½0ã€‚</p>
</li>
<li><p>å¯¹äºé›†åˆé‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå°†å…ƒç´ ä¾æ¬¡é€šè¿‡3ä¸ªå“ˆå¸Œå‡½æ•°è¿›è¡Œæ˜ å°„ï¼Œæ¯æ¬¡æ˜ å°„éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œè¿™ä¸ªå€¼å¯¹åº”ä½æ•°ç»„ä¸Šé¢çš„ä¸€ä¸ªç‚¹ï¼Œç„¶åå°†ä½æ•°ç»„å¯¹åº”çš„ä½ç½®æ ‡è®°ä¸º1ã€‚</p>
</li>
<li><p>æŸ¥è¯¢Wå…ƒç´ æ˜¯å¦å­˜åœ¨é›†åˆä¸­çš„æ—¶å€™ï¼ŒåŒæ ·çš„æ–¹æ³•å°†Wé€šè¿‡å“ˆå¸Œæ˜ å°„åˆ°ä½æ•°ç»„ä¸Šçš„3ä¸ªç‚¹ã€‚</p>
<ul>
<li><p>å¦‚æœ3ä¸ªç‚¹çš„å…¶ä¸­æœ‰ä¸€ä¸ªç‚¹ä¸ä¸º1ï¼Œåˆ™å¯ä»¥åˆ¤æ–­è¯¥å…ƒç´ ä¸€å®šä¸å­˜åœ¨é›†åˆä¸­ã€‚</p>
</li>
<li><p>åä¹‹ï¼Œå¦‚æœ3ä¸ªç‚¹éƒ½ä¸º1ï¼Œåˆ™è¯¥å…ƒç´ å¯èƒ½å­˜åœ¨é›†åˆä¸­ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ­¤å¤„ä¸èƒ½åˆ¤æ–­è¯¥å…ƒç´ æ˜¯å¦ä¸€å®šå­˜åœ¨é›†åˆä¸­ï¼Œå¯èƒ½å­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡ã€‚å¯ä»¥ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼šå‡è®¾æŸä¸ªå…ƒç´ é€šè¿‡æ˜ å°„å¯¹åº”ä¸‹æ ‡ä¸º4ï¼Œ5ï¼Œ6è¿™3ä¸ªç‚¹ã€‚è™½ç„¶è¿™3ä¸ªç‚¹éƒ½ä¸º1ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™3ä¸ªç‚¹æ˜¯ä¸åŒå…ƒç´ ç»è¿‡å“ˆå¸Œå¾—åˆ°çš„ä½ç½®ï¼Œå› æ­¤è¿™ç§æƒ…å†µè¯´æ˜å…ƒç´ è™½ç„¶ä¸åœ¨é›†åˆä¸­ï¼Œä¹Ÿå¯èƒ½å¯¹åº”çš„éƒ½æ˜¯1ï¼Œè¿™æ˜¯è¯¯åˆ¤ç‡å­˜åœ¨çš„åŸå› ã€‚</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h4 id="Rediså®ç°"><a href="#Rediså®ç°" class="headerlink" title="Rediså®ç°"></a>Rediså®ç°</h4><p>è°·æ­Œå…¬å¸æä¾›çš„Guava å·¥å…·æä¾›äº†å¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°ï¼Œå…ˆä¸åˆ†ææºç äº†å§ï¼Œæœ‰æœºä¼šè¡¥ä¸Šã€ã€flagã€‘ã€‘</p>
<h4 id="å¸ƒéš†è¿‡æ»¤å™¨åº”ç”¨ï¼ˆåæ­£è¿‡æ»¤å°±å¯¹äº†ï¼‰"><a href="#å¸ƒéš†è¿‡æ»¤å™¨åº”ç”¨ï¼ˆåæ­£è¿‡æ»¤å°±å¯¹äº†ï¼‰" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨åº”ç”¨ï¼ˆåæ­£è¿‡æ»¤å°±å¯¹äº†ï¼‰"></a>å¸ƒéš†è¿‡æ»¤å™¨åº”ç”¨ï¼ˆåæ­£è¿‡æ»¤å°±å¯¹äº†ï¼‰</h4><ul>
<li>å­—å¤„ç†è½¯ä»¶ä¸­ï¼Œéœ€è¦æ£€æŸ¥ä¸€ä¸ªè‹±è¯­å•è¯æ˜¯å¦æ‹¼å†™æ­£ç¡®</li>
<li>åœ¨ FBIï¼Œä¸€ä¸ªå«Œç–‘äººçš„åå­—æ˜¯å¦å·²ç»åœ¨å«Œç–‘åå•ä¸Š</li>
<li>åœ¨ç½‘ç»œçˆ¬è™«é‡Œï¼Œä¸€ä¸ªç½‘å€æ˜¯å¦è¢«è®¿é—®è¿‡</li>
<li>yahoo, gmailç­‰é‚®ç®±åƒåœ¾é‚®ä»¶è¿‡æ»¤åŠŸèƒ½</li>
</ul>
<p>è”æƒ³ä¸€ä¸‹ï¼šåˆ†å¸ƒå¼æ•°æ®åº“TiDBçš„TiKVä½¿ç”¨çš„åº•å±‚RocksDBæŸ¥è¯¢å°±åˆ©ç”¨äº†bloom filterä¸å­˜åœ¨å‡é˜´æ€§åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7074747080492711943">å®Œæ•´å«è¯¦ç»†è§£é‡Šæ¥æº1</a></p>
<p>ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨çš„å†…å®¹ä¹Ÿæ¥æºç½‘ç»œï¼Œçœ‹äº†å¥½å‡ ä¸ªéƒ½å¤§å·®ä¸å·®ï¼Œæ‰€ä»¥å°±çœç•¥å“©ï¼‰</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/03/20/dan-li-mo-shi-zui-hao-shi-xian-fang-shi/" title="ä¸€äº›å•ä¾‹æ¨¡å¼çš„å¯¹æ¯”"><img class="cover" src="/img/background/bg_bggenerator_com%20(2).png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">ä¸€äº›å•ä¾‹æ¨¡å¼çš„å¯¹æ¯”</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/19/redis-sds/" title="Redisâ€”â€”SDSç»“æ„æ¨¡å‹"><img class="cover" src="/img/background/bg_bggenerator_com%20(2).png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Redisâ€”â€”SDSç»“æ„æ¨¡å‹</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2023/03/22/redis-aof-chi-jiu-hua/" title="Redisâ€”â€”AOFæŒä¹…åŒ–"><img class="cover" src="/img/background/bg_bggenerator_com%20(2).png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-22</div><div class="title">Redisâ€”â€”AOFæŒä¹…åŒ–</div></div></a></div><div><a href="/2023/03/23/redis-rdb-kuai-zhao/" title="Redisâ€”â€”RDBå¿«ç…§"><img class="cover" src="/img/background/bg_bggenerator_com%20(2).png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-23</div><div class="title">Redisâ€”â€”RDBå¿«ç…§</div></div></a></div><div><a href="/2023/03/19/redis-sds/" title="Redisâ€”â€”SDSç»“æ„æ¨¡å‹"><img class="cover" src="/img/background/bg_bggenerator_com%20(2).png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-19</div><div class="title">Redisâ€”â€”SDSç»“æ„æ¨¡å‹</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.svg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ä»Šæ™šä¸ç†¬å¤œ</div><div class="author-info__description">åˆ«æ€¥~æƒŠå–œåœ¨è·¯ä¸Šï¼</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/quanquan170"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/quanquan170" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1480105462@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/1480105462" target="_blank" title="QQ"><i class="fa-brands fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ¥äº†éƒ½æ˜¯ç¼˜åˆ†ï¼Œç¥ä½ ä»Šå¤©é«˜å…´</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-text">1 åŸºæœ¬å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">2 æºç åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-text">2.1 æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-GETBIT"><span class="toc-text">3.2 GETBIT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-SETBIT"><span class="toc-text">3.3 SETBIT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-BITCOUNT"><span class="toc-text">2.4 BITCOUNT</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%BD%8D%E7%BB%9F%E8%AE%A1%E7%AE%97%E6%B3%95-variable-precision-SWAR"><span class="toc-text">äºŒè¿›åˆ¶ä½ç»Ÿè®¡ç®—æ³•:variable-precision SWAR</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-4-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">2.4.4 æºç åˆ†æ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%BA%94%E7%94%A8"><span class="toc-text">3 åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E7%AE%80%E4%BB%8B%E5%92%8C%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B"><span class="toc-text">å¸ƒéš†è¿‡æ»¤å™¨ç®€ä»‹å’Œç®—æ³•æµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E5%AE%9E%E7%8E%B0"><span class="toc-text">Rediså®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%BA%94%E7%94%A8%EF%BC%88%E5%8F%8D%E6%AD%A3%E8%BF%87%E6%BB%A4%E5%B0%B1%E5%AF%B9%E4%BA%86%EF%BC%89"><span class="toc-text">å¸ƒéš†è¿‡æ»¤å™¨åº”ç”¨ï¼ˆåæ­£è¿‡æ»¤å°±å¯¹äº†ï¼‰</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/23/redis-rdb-kuai-zhao/" title="Redisâ€”â€”RDBå¿«ç…§">Redisâ€”â€”RDBå¿«ç…§</a><time datetime="2023-03-23T11:14:20.000Z" title="å‘è¡¨äº 2023-03-23 19:14:20">2023-03-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/22/redis-aof-chi-jiu-hua/" title="Redisâ€”â€”AOFæŒä¹…åŒ–">Redisâ€”â€”AOFæŒä¹…åŒ–</a><time datetime="2023-03-22T11:14:20.000Z" title="å‘è¡¨äº 2023-03-22 19:14:20">2023-03-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/21/mysql-dan-biao-fang-wen-fang-fa/" title="MySQLâ€”â€”å•è¡¨è®¿é—®æ–¹æ³•">MySQLâ€”â€”å•è¡¨è®¿é—®æ–¹æ³•</a><time datetime="2023-03-21T03:59:20.000Z" title="å‘è¡¨äº 2023-03-21 11:59:20">2023-03-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/20/dan-li-mo-shi-zui-hao-shi-xian-fang-shi/" title="ä¸€äº›å•ä¾‹æ¨¡å¼çš„å¯¹æ¯”">ä¸€äº›å•ä¾‹æ¨¡å¼çš„å¯¹æ¯”</a><time datetime="2023-03-20T08:12:37.000Z" title="å‘è¡¨äº 2023-03-20 16:12:37">2023-03-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/20/redis-bitmap/" title="Redisâ€”â€”BitMap">Redisâ€”â€”BitMap</a><time datetime="2023-03-20T03:59:20.000Z" title="å‘è¡¨äº 2023-03-20 11:59:20">2023-03-20</time></div></div></div></div></div></div></main><footer id="footer" style="background: url(/img/imgs/redis.png)"><div id="footer-wrap"><div class="footer_custom_text">è°¢è°¢çœ‹åˆ°è¿™er~æ²¡æœ‰æ›´å¤šäº†å¥¥</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç®€</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></body></html>